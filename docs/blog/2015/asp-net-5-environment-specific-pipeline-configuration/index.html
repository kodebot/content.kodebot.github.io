
<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.57.2" />
  <meta name="description" content="">


  <link rel="icon" href="/images/favicon.ico" type="image/png">
  <title>ASP.NET 5 - Environment specific pipeline configuration - Kodebot</title>

  
  <link href="/css/nucleus.css?1568808109" rel="stylesheet">
  <link href="/css/fontawesome-all.min.css?1568808109"
    rel="stylesheet">
  <link href="/css/hybrid.css?1568808109" rel="stylesheet">
  <link href="/css/featherlight.min.css?1568808109" rel="stylesheet">
  <link href="/css/perfect-scrollbar.min.css?1568808109"
    rel="stylesheet">
  <link href="/css/auto-complete.css?1568808109" rel="stylesheet">
  <link href="/css/atom-one-dark-reasonable.css?1568808109"
    rel="stylesheet">
  <link href="/css/theme.css?1568808109" rel="stylesheet">
  <link href="/css/hugo-theme.css?1568808109" rel="stylesheet">
  
  <link href="/css/theme-mine.css?1568808109"
    rel="stylesheet">
  

  <script src="/js/jquery-3.3.1.min.js?1568808109"></script>

  <style type="text/css">
    :root #header+#content>#left>#rlblock_left {
      display: none !important;
    }

      {
        {
        if .Site.Params.disableInlineCopyToClipBoard
      }
    }

    :not(pre)>code+span.copy-to-clipboard {
      display: none;
    }

      {
        {
        end
      }
    }
  </style>
    
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
  
</head>

<body class="" data-url="/blog/2015/asp-net-5-environment-specific-pipeline-configuration/">
  <nav class="main-menu">
    <div class="logo">
        <a href="https://kodebot.com/">
            <img src="/images/logo.png" style="background: white; padding-right: 2px;">
        </a>
    </div>
    <ul>
        
        
        
                
        <li >
            <a href="/blog/" 
            class="active"
            >
                Blog
            </a>
        </li>

        
                
        <li >
            <a href="/tutorials/" >
                Tutorials
            </a>
        </li>

        
                
        <li >
            <a href="/about/" >
                About
            </a>
        </li>

        
        
    </ul>
</nav>
  <section id="body" class="no-sidebar">
    <div id="overlay"></div>
    <div class="padding highlightable">
      
      <div>
        
        
        <div id="top-bar">
          


          <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
            <span class="links">
              
          
          
          
          
          
          
          
          
          
          
          <a href='/'>Kodebot</a> > <a href='/blog/'>Blog</a> > ASP.NET 5 - Environment specific pipeline configuration
          
          
          
          
          
          
            </span>
          </div>
        </div>
        
      </div>
      
      <div id="head-tags">
        
<div class="tags">

  <a class="tag-link" href="/tags/asp.net">ASP.NET</a>

  <a class="tag-link" href="/tags/mvc">MVC</a>

</div>

      </div>
      
        <div id="body-inner">
          
          <h1>
            
            ASP.NET 5 - Environment specific pipeline configuration
          </h1>
          

          

<p><h4>Introduction</h4>
<p>In ASP.NET 5, we configure and add middlewares (aka pipelines) using Startup class. The convention is similar to Owin/Katana but not the same.</p>
<p>The Configuration method in Owin/Katana Startup class is replaced by Configure method and the parameter type is IApplicationBuilder rather than IAppBuilder and how we create and add&nbsp;middleware is also different to some extend.&nbsp;</p><!-- more -->
<p>ASP.NET 5 Startup class allows us to add and configure services using ConfigureService method, this is not available in Owin/Katana Startup class. The services we add using this method is added to the DependencyInjection container which comes with ASP.NET 5 out of the box.</p>
<h4>Environment awareness</h4>
<p>The Startup class can access the hosting environment details using IHostingEnvironment.&nbsp;When we specify IHostingEnvironment as a dependency by making it as a parameter in Startup constructor, ConfigureServices or Configure method, the dnx will populate it for us and DependencyInjection framework will inject the instance.</p>
<p>The injected instance has EnvironmentName property, the value of this property is set from an environment variable ASPNET_ENV. If this variable is not found then the value is set as Development.</p>
<p>The instance also has a handy method IsEnvironment to find out whether the code is running on a specific environment or not. We can use this to do things differently based on the environment where the code is running. For example, we can read different config files as shown below</p></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs">    <span style="color:#75715e">// Example
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Startup</span>
    {
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> IHostingEnvironment _env;

        <span style="color:#66d9ef">public</span> Startup(IHostingEnvironment env)
        {
            _env = env;
        }

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ConfigureServices(IServiceCollection services)
        {
            <span style="color:#66d9ef">if</span> (_env.IsEnvironment(<span style="color:#e6db74">&#34;Production&#34;</span>))
            {
                <span style="color:#75715e">// read prod config
</span><span style="color:#75715e"></span>            }
            <span style="color:#66d9ef">else</span>
            {
                <span style="color:#75715e">// read dev config
</span><span style="color:#75715e"></span>            }
        }

    .
    .
    .

   }
</code></pre></div>
<p>If we want to add/configure middlewares differently based on the environment then we can use IsEnvironment method just like how it is used in ConfigureServices method or we can use environment specific Configure methods.&nbsp;</p>
<p>The environment specific Configure method only support Development, Staging and Production environment names and the method names have to be ConfigureDevelopment, ConfigureStaging and ConfigureProduction respectively for this to work. Here is an example of how we can use this,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#75715e">// Full example
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Startup</span>
    {
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> IHostingEnvironment _env;

        <span style="color:#66d9ef">public</span> Startup(IHostingEnvironment env)
        {
            _env = env;
        }

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ConfigureServices(IServiceCollection services)
        {
            <span style="color:#66d9ef">if</span> (_env.IsEnvironment(<span style="color:#e6db74">&#34;Production&#34;</span>))
            {
                <span style="color:#75715e">// read prod config
</span><span style="color:#75715e"></span>            }
            <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (_env.IsEnvironment(<span style="color:#e6db74">&#34;Staging&#34;</span>))
            {
                <span style="color:#75715e">// read staging config
</span><span style="color:#75715e"></span>            }
            <span style="color:#66d9ef">else</span>
            {
                <span style="color:#75715e">// read dev config
</span><span style="color:#75715e"></span>            }
        }

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ConfigureDevelopment(IApplicationBuilder builder, IHostingEnvironment env)
        {
            <span style="color:#75715e">// Development configuration
</span><span style="color:#75715e"></span>            Configure(builder);
        }

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ConfigureStaging(IApplicationBuilder builder)
        {
            <span style="color:#75715e">// Staging configuration
</span><span style="color:#75715e"></span>            Configure(builder);
        }

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> ConfigureProduction(IApplicationBuilder builder)
        {
            <span style="color:#75715e">// Production configuration
</span><span style="color:#75715e"></span>            Configure(builder);
        }

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Configure(IApplicationBuilder builder)
        {
            <span style="color:#75715e">// Common
</span><span style="color:#75715e"></span>        }
    }
</code></pre></div>
<p>This allows us to keep environment specific configurations/pipelines in a better&nbsp;way.&nbsp;</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        


    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kodebot" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/blog/2015/asp-net-5-tag-helpers-the-html-way/" title="ASP.NET 5 - Tag Helpers, the HTML way"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/blog/2015/owin-katana-core-middleware-patterns/" title="Owin - Katana core middleware patterns" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1568808110"></script>
    <script src="/js/perfect-scrollbar.min.js?1568808110"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1568808110"></script>
    <script src="/js/jquery.sticky.js?1568808110"></script>
    <script src="/js/featherlight.min.js?1568808110"></script>
    <script src="/js/highlight.pack.js?1568808110"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1568808110"></script>
    <script src="/js/learn.js?1568808110"></script>
    <script src="/js/hugo-learn.js?1568808110"></script>

    <link href="/mermaid/mermaid.css?1568808110" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1568808110"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    


    <div class="custom-footer">
        <div class="copy">
            &copy; 2014 - 2019 Kodebot Limited. All Rights Reserved.<br>
        </div>
        <div class="license">
            All content on this website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">
                (CC
                BY-SA 3.0)
                Creative Commons Attribution-ShareAlike 3.0 Unported License</a>. All source code published here is
            licensed
            under the
            <a href="http://opensource.org/licenses/MIT"> MIT License</a> unless explicitly stated otherwise. The
            content is
            provided for
            educational and informational purposes only without any warranties, guarantees or conditions, of any kind,
            and
            may not be accurate,
            up to date or complete. Any use or reliance on any content or materials published, mentioned or linked here
            is
            at your own risk and
            the Kodebot Limited and author/authors accept no liability or responsibility for.
        </div>
    </div>



<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script>
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#3937a3"
    },
    "button": {
      "background": "red"
    }
  }
});
</script>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146320930-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




<script type="text/javascript">
  var vglnk = {key: '1b96d3cbccc60ff70400c5266777c7e5'};
  (function(d, t) {
      var s = d.createElement(t);
          s.type = 'text/javascript';
          s.async = true;
          s.src = '//cdn.viglink.com/api/vglnk.js';
      var r = d.getElementsByTagName(t)[0];
          r.parentNode.insertBefore(s, r);
  }(document, 'script'));
</script>


  </body>
</html>
